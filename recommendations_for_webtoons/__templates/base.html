{% load static %}
<!doctype html>

<html lang="en">
    <head>
        <script>
            $.ajaxSetup({
                headers: { "X-CSRFToken": '{{csrf_token}}' }
            });
        </script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
        <meta name="generator" content="Jekyll v4.0.1">

        <title>AIVLETOON</title>
        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

        {% include "./__js_css.html" %}
        {% include "./_common_modal.html" %}
        <link rel="icon" href="{% static 'static/icon/favicon.ico' %}">
        

        {% block loads %}
            
        {% endblock %}

        <style>
            html {
                scroll-behavior: smooth;
            }
            body{
                -ms-overflow-style: none;
                }
                
            ::-webkit-scrollbar {
                display: none;
                }

            .error_login {
                animation-iteration-count: 50;
               animation: vibration .1s infinite !important;
            }

            @keyframes vibration {
                from {
                    transform: rotate(1deg);
                }
                to {
                    transform: rotate(-1deg);
                }
            }
            {% include "./__font.html" %}
            
            {% block styles %}
                
            {% endblock %}
        </style>
    </head>


    <body scroll=auto style="overflow-x:hidden; background-color:#111111">
        
        {% include "./_topmenu.html" %}

        {% block body %}


        {% endblock %}


        <script type="text/javascript">
            function request_ajax(url, data_dict) {
                $.ajax({
                    url:url,
                    type:'POST',
                    async:false,
                    data:data_dict,
                    success: function (response) {
                            result = response
                            },
                error: function (e) {
                        alert("connenction error")
                        result = "error"
                        }
                        });
                    return result;
            }

        $(document).on("click","#btn_search", function(){
            const modals = document.querySelector('#search_modal');
            let modal = bootstrap.Modal.getOrCreateInstance(modals)  
            modal.show()
        })


        $(document).on("click","#btn_login", function(){
            const modals = document.querySelector('#modal_login');
            let modal = bootstrap.Modal.getOrCreateInstance(modals)  
            let id = document.getElementById('ID_login');
            let pw = document.getElementById('PW_login');
            id.value = null;
            pw.value = null;
            $('.info_login').hide();
            modal.show()
        })

        $(document).on("click","#to_join", function(){
            const modals = document.querySelector('#modal_join');
            let modal = bootstrap.Modal.getOrCreateInstance(modals)  
            $('#id_join').val('');
            $('#pw1_join').val('');
            $('#pw2_join').val('');
            $('#name_join').val('');
            $('#nick_join').val('');
            $('#date_join').val('');
            $('#gender_join').val('성별');
            $('.info_join').hide();
            modal.show()
        })

        $(document).on("click","#submit_login", function(){
            login_auth()
        })

        function login_auth(){
            let id = $('#ID_login').val();
            let pw = $('#PW_login').val();
            let ajax_url = "{% url 'rcmd:log_in' %}"
            data_dict = {'email' : id, 'password': pw}
            result = request_ajax(ajax_url, data_dict)
            if (result == 'error' || result.response == 'error'){
                error_login()
            } else {
                location.reload();
            }
        }

        function error_login(){
            $('.info_login').show();
            $('#modal_login').addClass('error_login');
            setTimeout(() => {
                $('#modal_login').removeClass('error_login');
            }, 200)
        }

        function error_join(){
            $('.info_join').show();
            $('#modal_join').addClass('error_login');
            setTimeout(() => {
                $('#modal_join').removeClass('error_login');
            }, 200)
        }


        $(document).on("click","#submit_join", function(){
            if (join_validation()) {
                let ajax_url = "{% url 'rcmd:join' %}"
                let id = $('#id_join').val();
                let pw1 = $('#pw1_join').val();
                let pw2 = $('#pw2_join').val();
                let nm = $('#name_join').val();
                let nc = $('#nick_join').val();
                let dt = $('#date_join').val();
                let gd = $('#gender_join').val();
                data_dict = {'email' : id,
                             'password1': pw1,
                             'password2': pw2,
                             'username': nm,
                             'nickname': nc,
                             'birth': dt,
                             'gender': gd}
                result = request_ajax(ajax_url, data_dict)
                if (result == 'error' || result.response == 'error'){
                    error_join()
                } else {
                    location.reload();
                }
            } else {
                error_join()
            }
        })

        function join_validation() {
            if ($('#id_join').val().indexOf("@") == -1){
                $('.info_join').text('이메일 형식이 아닙니다.')
                return false
            }
            if ($('#pw1_join').val().length < 6){
                $('.info_join').text('비밀번호는 6자 이상으로 입력해주세요.')
                return false
            }
            if ($('#pw1_join').val() !== $('#pw2_join').val()){
                $('.info_join').text('비밀번호 구성이 다릅니다..')
                return false
            }
            if ($('#name_join').val().length == 0){
                $('.info_join').text('이름을 입력해주세요.')
                return false
            }
            if ($('#nick_join').val().length == 0){
                $('.info_join').text('별명을 입력해주세요.')
                return false
            }
            if ($('#date_join').val()==''){
                $('.info_join').text('생년월일을 입력해주세요.')
                return false
            }
            if ($('#gender_join').val()=='성별'){
                $('.info_join').text('성별을 선택해주세요.')
                console.log("B")
                return false
            }
            return true
        }


            {% block scripts %}

            {% endblock %}
        </script>

    </body>
</html>
